---
title: "LIRS Rapid Response Survey: 2020-21 Follow-up Results"
author: "Immigration Policy Lab"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  pdf_document:
    toc: yes
    toc_depth: 2
    number_sections: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE, fig.retina = 4)
knitr::opts_chunk$set(fig.pos = 'H')
```


\newpage

```{r}
# Libraries
pacman::p_load(tidyverse, readxl, janitor, lubridate, extrafont, estimatr, fastDummies, zoo, hrbrthemes, compareGroups)
extrafont::loadfonts()
```

```{r}
# baseline data
df_baseline <- read_csv(here::here("data", "Rapid_response_baseline_cleaned_all_consent.csv"))
```

```{r}
# google sheet data
df_updated <- 
  read_xlsx(here::here("data/merge", "lirs_postresponses_updated_all.xlsx")) %>% 
  mutate(
    number_from = parse_number(number_from) %>% as.character(),
    date = as_datetime(date),
    wave = str_c(month(date), year(date), sep = "-")
  ) %>%
  mutate(
    wave = if_else(wave == "8-2020", "9-2020", wave),
    wave = if_else(wave == "12-2020", "11-2020", wave),
    wave = if_else(wave == "3-2021", "2-2021", wave),
    wave = if_else(wave == "5-2021", "6-2021", wave)
  ) %>% # edited misnumbered waves here
  arrange(number_from, desc(date)) %>%
  distinct(wave, number_from, .keep_all = TRUE) %>%
  drop_na(number_from)

# handling posted failures
df_updated_manual <- 
  read_xlsx(here::here("data/merge", "lirs_postresponses_updated_all.xlsx"), sheet = "Post_failures") %>% 
  mutate(
    number_from = parse_number(number_from) %>% as.character(),
    date = as_datetime(date),
    wave = str_c(month(date), year(date), sep = "-")
  ) %>% 
  mutate(wave = if_else(wave == "8-2020", "9-2020", wave)) %>%
  arrange(number_from, desc(date)) %>%
  distinct(wave, number_from, .keep_all = TRUE) %>%
  drop_na(number_from) %>% 
  select(number_from, date, wave, q0_response, q1_response:q18_response) %>% 
  mutate_at(vars(starts_with("q")), as.character)

df_updated <- 
  bind_rows(df_updated, df_updated_manual) %>% 
  arrange(number_from, desc(date)) %>% 
  distinct(wave, number_from, .keep_all = TRUE)

# df_updated %>% count(wave)
```

```{r}
# twilio contact data
df_whatsapp_twilio <- read_xlsx(here::here("data/merge", "whatsapp_twilio.xlsx"))
df_sms_twilio <- read_xlsx(here::here("data/merge", "sms_twilio.xlsx"))
df_twilio <- 
  bind_rows(
    df_whatsapp_twilio %>% select(study_ID, number_from = whatsAppNumber_final, lang = languageFollowUps), 
    df_sms_twilio %>% select(study_ID, number_from = smsNumber_final, lang = languageFollowUps),
    .id = "medium"
  ) %>% 
  mutate(
    medium = recode(medium, `1` = "WhatsApp", `2` = "SMS", .default = NA_character_),
  ) %>% 
  distinct(study_ID, .keep_all = TRUE) %>% 
  distinct(number_from, .keep_all = TRUE)

# removing redundant datasets
rm(df_whatsapp_twilio, df_sms_twilio, df_updated_manual)

df_twilio %>% count(medium)

df_twilio %>% 
  inner_join(df_baseline, by = "study_ID") %>%
  anti_join(df_updated, by = "number_from")
```


```{r, eval=F}
# failed/undelivered delivery numbers to be excluded later
errors_sep2020 <- 
  read_csv(here::here("data", "merge/error_reports/errors1_sep2020.csv")) %>% 
  bind_rows(read_csv(here::here("data", "merge/error_reports/errors2_sep2020.csv"))) %>% 
  mutate(number_from = parse_number(`To`) %>% as.character()) %>% 
  distinct(number_from) %>% 
  unlist()

errors_oct2020 <- 
  read_csv(here::here("data", "merge/error_reports/errors1_oct2020.csv")) %>% 
  bind_rows(read_csv(here::here("data", "merge/error_reports/errors2_oct2020.csv"))) %>% 
  mutate(number_from = parse_number(`To`) %>% as.character()) %>% 
  distinct(number_from) %>% 
  unlist()

errors_nov2020 <- 
  read_csv(here::here("data", "merge/error_reports/errors1_nov2020.csv")) %>% 
  bind_rows(read_csv(here::here("data", "merge/error_reports/errors2_nov2020.csv"))) %>% 
  mutate(number_from = parse_number(`To`) %>% as.character()) %>% 
  distinct(number_from) %>% 
  unlist()

errors_feb2021 <- 
  read_csv(here::here("data", "merge/error_reports/errors1_feb2021.csv")) %>% 
  bind_rows(read_csv(here::here("data", "merge/error_reports/errors2_feb2021.csv"))) %>% 
  mutate(number_from = parse_number(`To`) %>% as.character()) %>% 
  distinct(number_from) %>% 
  unlist()

errors_jun2021 <- 
  read_csv(here::here("data", "merge/error_reports/errors1_jun2021.csv")) %>% 
  bind_rows(read_csv(here::here("data", "merge/error_reports/errors2_jun2021.csv"))) %>% 
  mutate(number_from = parse_number(`To`) %>% as.character()) %>% 
  distinct(number_from) %>% 
  unlist()
```


```{r}
# merging it all together
df_main <-
  # df_updated %>%
  # inner_join(df_twilio, ., by = "number_from") %>%
  # inner_join(df_baseline, by = "study_ID") %>%
  df_twilio %>%
  inner_join(df_baseline, by = "study_ID") %>%
  left_join(df_updated, by = "number_from") %>%
  mutate(
    lang = if_else(lang %in% c("Don't know", "Refused"), NA_character_, lang),
    lang_match = 
      case_when(
        lang == "Arabic" & Arabic %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "Dari/Farsi" & Farsi %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "Dari/Farsi" & Dari %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "English" & English %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "Farsi" & Farsi %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "Farsi" & Dari %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "French" & French %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "Russian" & Russian %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "Spanish" & Spanish %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        lang == "Swahili" & Swahili %in% c("NATIVE", "R", "RW", "W", "R NATIVE", "RW NATIVE") ~ "Match",
        TRUE ~ "No match"
      ),
    survey_started = (q1_response != "No Data"),
    survey_completed = (q18_response != "No Data"),
    id_matched = if_else(yearArrive == q18_response, 1L, 0L),
    wave = as.yearmon(wave, "%m-%Y") %>% as.character() %>% factor(levels = c("Sep 2020", "Oct 2020", "Nov 2020", "Feb 2021", "Jun 2021"))
  ) %>% 
  # filter(!((number_from %in% errors_sep2020) & wave == "Sep 2020")) %>%
  # filter(!((number_from %in% errors_oct2020) & wave == "Oct 2020")) %>%
  # filter(!((number_from %in% errors_nov2020) & wave == "Nov 2020")) %>%
  # filter(!((number_from %in% errors_feb2021) & wave == "Feb 2021")) %>%
  # filter(!((number_from %in% errors_jun2021) & wave == "Jun 2021")) %>%
  mutate_at(vars(q1_response:q18_response), str_to_lower) %>% 
  mutate_at(vars(q1_response:q18_response), ~ str_replace_all(., "[.]", "")) %>% 
  mutate(
    female = recode(gender, "Male" = "0", "Female" = "1", .default = NA_character_) %>% as.character %>% parse_integer(),
    unemploymentBeneBaseline = if_else(unemploymentBeneBaseline == "Yes", "1", unemploymentBeneBaseline),
    unemploymentBeneBaseline = if_else(unemploymentBeneBaseline == "No", "0", unemploymentBeneBaseline),
    unemployment = unemploymentBeneBaseline %>% as.integer(),
    any_income = 1 - unemployment,
    food_insecurity = if_else(str_detect(foodSecurity1Baseline, "^Enough"), "0", foodSecurity1Baseline),
    food_insecurity = if_else(str_detect(food_insecurity, "not enough"), "1", food_insecurity),
    food_insecurity = if_else(food_insecurity %in% c("0", "1"), food_insecurity, NA_character_),
    food_insecurity = food_insecurity %>% as.integer(),
  )

df_main %>% tabyl(medium, wave)
```






```{r}
# Sep 2020
#responded <- tibble(c(0,0,0))

df_main %>%
  filter(medium == "WhatsApp", wave == "Sep 2020") %>%
  mutate(
    responded = if_else(survey_completed & id_matched, 1L, 0L),
    responded = if_else(is.na(responded), 0L, responded)  
  ) %>% 
  #bind_rows(responded) %>% 
  compareGroups(responded ~ female + birthYear + householdSize + any_income + food_insecurity, data = .) %>% 
  createTable(show.all = F)
```

```{r}
# Sep 2020
round(sqrt((0.48^2 / 543) + (0.43^2 / 258)), 2)
round(sqrt((10.9^2 / 543) + (9.93^2 / 258)), 2)
round(sqrt((2.44^2 / 543) + (2.20^2 / 258)), 2)
round(sqrt((0.42^2 / 543) + (0.43^2 / 258)), 2)
round(sqrt((0.41^2 / 543) + (0.38^2 / 258)), 2)
```





```{r}
# Feb 2021
df_main %>%
  filter(medium == "WhatsApp", wave == "Feb 2021") %>%
  mutate(
    responded = if_else(survey_completed & id_matched, 1L, 0L),
    responded = if_else(is.na(responded), 0L, responded)  
  ) %>%
  compareGroups(responded ~ female + birthYear + householdSize + any_income + food_insecurity, data = .) %>% 
  createTable(show.all = F)
```

```{r}
# Feb 2021
round(sqrt((0.47^2 / 580) + (0.46^2 / 197)), 2)
round(sqrt((10.6^2 / 580) + (10.5^2 / 197)), 2)
round(sqrt((2.37^2 / 580) + (2.29^2 / 197)), 2)
round(sqrt((0.42^2 / 580) + (0.43^2 / 197)), 2)
round(sqrt((0.39^2 / 580) + (0.41^2 / 197)), 2)
```




```{r}
# Jun 2021
df_main %>%
  filter(medium == "WhatsApp", wave == "Jun 2021") %>%
  mutate(
    responded = if_else(survey_completed & id_matched, 1L, 0L),
    responded = if_else(is.na(responded), 0L, responded)  
  ) %>%
  compareGroups(responded ~ female + birthYear + householdSize + any_income + food_insecurity, data = .) %>% 
  createTable(show.all = F)
```

```{r}
# Jun 2021
round(sqrt((0.47^2 / 624) + (0.46^2 / 146)), 2)
round(sqrt((10.5^2 / 624) + (10.7^2 / 146)), 2)
round(sqrt((2.36^2 / 624) + (2.32^2 / 146)), 2)
round(sqrt((0.43^2 / 624) + (0.41^2 / 146)), 2)
round(sqrt((0.40^2 / 624) + (0.38^2 / 146)), 2)
```




```{r}
df_main %>%
  filter(medium == "WhatsApp", wave == "Sep 2020") %>%
  mutate(
    responded = if_else(survey_completed & id_matched, 1L, 0L),
    responded = if_else(is.na(responded), 0L, responded)  
  ) %>%
  group_by(responded) %>% 
  summarize(
    mean_birth = round(mean(birthYear, na.rm = T), 2),
    sd_birth = round(sd(birthYear, na.rm = T), 2),
  )
```
















```{r, eval = F}
df_main %>% tabyl(wave, medium)

df_main %>% filter(medium == "WhatsApp") %>% count(wave)

df_main %>% filter(wave == "Sep 2020") %>% 
  inner_join(df_main %>% filter(wave == "Oct 2020"), by = "study_ID") %>% 
  inner_join(df_main %>% filter(wave == "Nov 2020"), by = "study_ID") %>% 
  inner_join(df_main %>% filter(wave == "Feb 2021"), by = "study_ID") %>% 
  inner_join(df_main %>% filter(wave == "Jun 2021"), by = "study_ID")

749 / (4547/5)
```


# Response rates

## Overall

```{r}
df_main %>%
  select(wave, survey_started, survey_completed) %>% 
  group_by(wave) %>% 
  summarize(
    `Survey started` = mean(survey_started, na.rm = TRUE),
    `Survey completed` = mean(survey_completed, na.rm = TRUE)
  ) %>% 
  mutate(`Completed if started` = `Survey completed` / `Survey started`) %>% 
  pivot_longer(cols = -wave, names_to = "name", values_to = "percentage") %>%
  full_join(
    df_main %>% 
      select(wave, survey_started, survey_completed) %>%
      group_by(wave) %>% 
      summarize(
        `Survey started` = sum(survey_started, na.rm = TRUE),
        `Survey completed` = sum(survey_completed, na.rm = TRUE),
        `Total` = sum(n(), na.rm = TRUE)
      ) %>% 
      pivot_longer(cols = -wave, names_to = "name", values_to = "count"),
    by = c("wave", "name")
  ) %>% 
  arrange(wave) %>% 
  mutate(
    percentage = (percentage * 100) %>% round(2) %>% as.character() %>% str_c("%"),
    percentage = replace_na(percentage, "--"),
    count = replace_na(count, "--")
  ) %>% 
  knitr::kable()


df_main %>% 
  select(wave, survey_started, survey_completed) %>% 
  group_by(wave) %>% 
  summarize(
    `Survey started` = mean(survey_started, na.rm = TRUE),
    `Survey completed` = mean(survey_completed, na.rm = TRUE)
  ) %>% 
  mutate(`Completed if started` = `Survey completed` / `Survey started`) %>% 
  pivot_longer(cols = -wave, names_to = "name", values_to = "value") %>% 
  mutate(name = factor(name, levels = c("Survey started", "Survey completed", "Completed if started"))) %>%  
  ggplot(aes(wave, value)) +
  geom_line(aes(group = factor(name), color = factor(name)), size = 1) +
  geom_point(aes(group = factor(name), color = factor(name)), size = 2) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  theme(legend.position = "bottom") +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves",
    color = ""
  )


df_main %>% 
  select(wave, survey_started, survey_completed) %>% 
  group_by(wave) %>% 
  summarize(
    `Survey started` = mean(survey_started, na.rm = TRUE),
    `Survey completed` = mean(survey_completed, na.rm = TRUE)
  ) %>% 
  mutate(`Completed if started` = `Survey completed` / `Survey started`) %>% 
  pivot_longer(cols = -wave, names_to = "name", values_to = "value") %>% 
  mutate(name = factor(name, levels = c("Survey started", "Survey completed", "Completed if started"))) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>%  # edit if need to see other waves
  ggplot(aes(name, value)) +
  geom_col(color = "black") +
  scale_y_continuous(
    breaks = scales::breaks_width(0.2),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  facet_wrap(vars(wave)) +
  theme(axis.text.x = element_text(angle = -60, hjust = 0)) +
  labs(
    x = "",
    y = "Survey rate",
    title = "Responses from last two waves"
  )
```



```{r, eval=F}
# for whatsapp paper table 1
df_main %>%
  filter(medium == "WhatsApp") %>% 
  select(wave, survey_started, survey_completed) %>% 
  group_by(wave) %>% 
  summarize(
    `Survey started` = mean(survey_started, na.rm = TRUE),
    `Survey completed` = mean(survey_completed, na.rm = TRUE)
  ) %>% 
  mutate(`Completed if started` = `Survey completed` / `Survey started`) %>% 
  pivot_longer(cols = -wave, names_to = "name", values_to = "percentage") %>%
  full_join(
    df_main %>% 
      filter(medium == "WhatsApp") %>%
      select(wave, survey_started, survey_completed) %>%
      group_by(wave) %>% 
      summarize(
        `Survey started` = sum(survey_started, na.rm = TRUE),
        `Survey completed` = sum(survey_completed, na.rm = TRUE),
        `Total` = sum(n(), na.rm = TRUE)
      ) %>% 
      pivot_longer(cols = -wave, names_to = "name", values_to = "count"),
    by = c("wave", "name")
  ) %>% 
  arrange(wave)

# march 2022
df_main %>%
    filter(medium == "WhatsApp", wave %in% c("Sep 2020", "Feb 2021", "Jun 2021")) %>%
    select(wave, survey_started, survey_completed, id_matched) %>%
    mutate(completed_and_matched = (survey_completed & id_matched)) %>% 
    group_by(wave) %>% 
    summarize(
      `Survey started` = sum(survey_started, na.rm = TRUE),
      `Survey completed` = sum(survey_completed, na.rm = TRUE),
      `Completed & matched` = sum(completed_and_matched, na.rm = TRUE),
      `Total` = 806#sum(n(), na.rm = TRUE)
    ) %>% 
  mutate(
    `% Started` = round(100 * `Survey started`/`Total`, 1),
    `% Completed` = round(100 * `Survey completed`/`Total`, 1),
    `% Completed & matched` = round(100 * `Completed & matched` / `Total`, 1),
    `% Completed if started` = round(100 * `Survey completed` / `Survey started`, 1),
  ) %>% view()

round(100 * 153/168, 1)
```




\newpage

On average, respondents who started the survey answered around 90% survey questions. 

```{r}
df_main %>%
  filter(survey_started) %>%
  select(wave, q1_response:q18_response) %>%
  na_if("no data") %>% 
  mutate(
    row_nas = rowSums(!is.na(.)) / 18
  ) %>%
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>%
  ggplot(aes(row_nas)) +
  geom_histogram(fill = "gray", color = "black", binwidth = 0.05) +
  geom_vline(aes(xintercept = mean(row_nas, na.rm = TRUE)), linetype = "dashed", color = "blue") +
  scale_x_continuous(
    breaks = scales::breaks_width(0.2),
    labels = scales::percent_format(accuracy = 1)
  ) +
  facet_wrap(vars(wave)) +
  theme_bw() +
  labs(
    x = "Percentage questions answered",
    y = "Number of respondents",
    caption = "Note: Blue dashed line represents the distribution mean",
    title = "Responses from last two waves"
  )
```

\newpage

## Question-wise

The question-wise response rates for survey starters stays consistent.

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, q1_response:q18_response) %>%
  na_if("no data") %>% 
  group_by(wave) %>% 
  summarise_at(vars(starts_with("q")), ~ mean(!is.na(.))) %>% 
  pivot_longer(cols = starts_with("q"), names_to = "question", values_to = "answers") %>% 
  mutate(
    conditional = question %in% c("q4_response", "q7_response", "q15_response", "q16_response"),
    question = str_replace(question, "_response", ""),
    question = str_replace(question, "q", "Question "),
    question = question %>% fct_inorder() %>% fct_rev()
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(question, answers, fill = conditional)) +
  geom_col() +
  scale_y_continuous(
    breaks = scales::breaks_width(0.2),
    labels = scales::percent_format(accuracy = 1)
  ) +
  scale_fill_brewer(palette = "Set2") +
  theme_bw() +
  theme(legend.position = "bottom") +
  facet_wrap(vars(wave)) +
  coord_flip() +
  labs(
    x = "Survey Questions",
    y = "Percentage respondents answering",
    fill = "Conditional question",
    title = "Responses from last two waves"
  )
```

\newpage

# Question-wise results

## Employment Situation

Which of these descriptions best applies to what you have been doing for the last four weeks? Please respond with the number of your response.

1. In paid work
2. In school
3. Unemployed and actively looking for a job
4. Unemployed and not actively looking for a job
5. Other


```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q1_response) %>%
  na_if("no data") %>% 
  mutate(ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()) %>%
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )


df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q1_response) %>%
  na_if("no data") %>% 
  mutate(ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()) %>%
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>%
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(ans, percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Hours Worked

In the past four weeks, how many hours did you usually work each week? Please respond with the number of your response.

1. 0
2. 1-10
3. 11-20
4. 21-35
5. 36 or more

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q2_response) %>%
  na_if("no data") %>% 
  mutate(ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()) %>%
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )

df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q2_response) %>%
  na_if("no data") %>% 
  mutate(ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()) %>%
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(ans, percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Unemployment Benefits

In the past four weeks, have you received any money from unemployment benefits? Please respond with the number of your response.

1. Yes
2. No

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q3_response) %>%
  na_if("no data") %>%
  mutate(
    ans = recode(ans, "yes" = "1", "no" = "2"),
    ans = if_else(ans %in% c(1,2), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )


df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q3_response) %>%
  na_if("no data") %>%
  mutate(
    ans = recode(ans, "yes" = "1", "no" = "2"),
    ans = if_else(ans %in% c(1,2), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Unemployment Compensation (Conditional on being unemployed)

What was the total amount of unemployment compensation you received over the last four weeks? Please respond with the number of your response.

1. \$0-$500
2. \$501-$1000
3. \$1001-$1500
4. \$1501-$2000
5. $2001+

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q4_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )

df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q4_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Living Situation

In the last four weeks, which of the below best describes your living situation? Please respond with the number of your response.

1. House
2. Apartment
3. Mobile home
4. Other type of housing
5. No housing (homeless)


```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q5_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )

df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q5_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Ownership Status

Is your current house, apartment, or mobile home…? Please respond with the number of your response.

1. Owned free and clear
2. Owned with a mortgage or loan (including home equity loans)
3. Rented
4. Occupied without payment of rent


```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q6_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>%
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )

df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q6_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Rent Payment

Did you pay your last month’s rent or mortgage on time? Please respond with the number of your response.

1. Yes
2. No
3. Payment was deferred

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q7_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>%
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )

df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q7_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Food Situation

In the last four weeks, which of these statements best describes the food eaten in your household? Please respond with the number of your response.

1. Enough of the kinds of food (I/we) wanted to eat
2. Enough, but not always the kinds of food (I/we) wanted to eat
3. Sometimes not enough to eat
4. Often not enough to eat


```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q8_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )


df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q8_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Free Groceries

In the last four weeks, did you or anyone in your household get free groceries or a free meal? Please respond with the number of your response.

1. Yes
2. No

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q9_response) %>%
  na_if("no data") %>%
  mutate(
    ans = recode(ans, "yes" = "1", "no" = "2"),
    ans = if_else(ans %in% c(1,2), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )

df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q9_response) %>%
  na_if("no data") %>%
  mutate(
    ans = recode(ans, "yes" = "1", "no" = "2"),
    ans = if_else(ans %in% c(1,2), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Food Security

How confident are you that your household will be able to afford the kinds of food you need for the next four weeks? Please respond with the number of your response.

1. Not at all confident
2. Somewhat confident
3. Moderately confident
4. Very confident

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q10_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )

df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q10_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## General Health Situation

Would you say your health in general has been excellent, very good, good, fair, or poor? Please respond with the number of your response.

1. Excellent
2. Very good
3. Good
4. Fair
5. Poor

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q11_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )


df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q11_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Mental Health Situation

During the last four weeks, about how often did you feel nervous? Please respond with the number of your response.

1. All of the time
2. Most of the time
3. Some of the time
4. A little of the time
5. None of the time

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q12_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )


df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q12_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Medical Care Access

At any time in the last four weeks, did you delay getting medical care? Please respond with the number of your response.

1. Yes
2. No

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q13_response) %>%
  na_if("no data") %>%
  mutate(
    ans = recode(ans, "yes" = "1", "no" = "2"),
    ans = if_else(ans %in% c(1,2), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )


df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q13_response) %>%
  na_if("no data") %>%
  mutate(
    ans = recode(ans, "yes" = "1", "no" = "2"),
    ans = if_else(ans %in% c(1,2), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Education Situation

In the past four weeks, how have children in this household received education from their school? Please respond with the number of your response.

1. In-person instruction at school
2. Distance learning only (online or using paper materials)
3. Both in-person instruction and distance learning
4. Neither in-person instruction nor distance learning
5. School closed due to scheduled vacation or break
6. Not applicable

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q14_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5,6), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )


df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q14_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5,6), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Distance Learning (Conditional on children in household)

Which type of distance learning education have your children received? Please respond with the number of your response.

1. Online only (self-paced or real-time)
2. Paper materials only
3. Both online and paper materials

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q15_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )


df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q15_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Internet Access to Children (Conditional on children in household)

How often is the Internet available to children for educational purposes? Please respond with the number of your response.

1. Always available
2. Usually available
3. Sometimes available
4. Rarely available
5. Never available

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q16_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>%
  ggplot(aes(wave, percent)) +
  geom_line(aes(group = factor(ans), color = factor(ans)), size = 1, show.legend = F) +
  geom_point(aes(group = factor(ans), color = factor(ans)), size = 2, show.legend = F) +
  ggrepel::geom_text_repel(
    aes(label = ans, color = factor(ans)),
    data = . %>% group_by(ans) %>% top_n(1, wt = wave),
    nudge_x = 0.2,
    direction = "y",
    show.legend = F
  ) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Waves",
    y = "Percentage of respondents",
    title = "Responses from all waves"
  )

df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q16_response) %>%
  na_if("no data") %>%
  mutate(
    ans = if_else(ans %in% c(1,2,3,4,5), ans, NA_character_) %>% as.integer()
  ) %>% 
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Year of Birth

What year were you born? (for example, 1980)

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q17_response) %>%
  na_if("no data") %>%
  mutate(
    ans = parse_number(ans),
    ans = if_else(ans >= 1900 & ans <= 2020, ans, NA_real_) %>% as.integer()
  ) %>%
  drop_na(ans) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(ans)) +
  geom_histogram() +
  facet_wrap(vars(wave)) +
  theme_bw() +
  labs(
    x = "Response distribution",
    y = "Number of respondents",
    title = "Responses from last two waves"
  )
```

\newpage

## Year of Arrival

What year did you arrive in the United States? (for example, 2000)

```{r}
df_main %>% 
  filter(survey_started) %>% 
  select(wave, ans = q18_response) %>%
  na_if("no data") %>%
  mutate(
    ans = parse_number(ans),
    ans = if_else(ans >= 2010 & ans <= 2020, ans, NA_real_) %>% as.integer()
  ) %>%
  drop_na(ans) %>% 
  group_by(wave, ans) %>% 
  summarise(count1 = n()) %>% 
  mutate(count2 = sum(count1)) %>% 
  ungroup() %>% 
  mutate(
    percent = count1 / count2
  ) %>% 
  filter(wave %in% c("Feb 2021", "Jun 2021")) %>% 
  ggplot(aes(factor(ans), percent)) +
  geom_col() +
  geom_text(aes(label = count1), vjust = -0.3) +
  facet_wrap(vars(wave)) +
  scale_y_continuous(
    breaks = scales::breaks_width(0.1),
    labels = scales::percent_format(accuracy = 1)
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = -45, hjust = 0)) +
  labs(
    x = "Responses",
    y = "Percentage of respondents",
    title = "Responses from last two waves"
  )
```

